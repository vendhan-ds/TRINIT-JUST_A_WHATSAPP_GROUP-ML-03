{"version":3,"sources":["../src/bootstrap.js","../node_modules/dom-to-image-more/src/dom-to-image-more.js","../node_modules/file-saver/dist/FileSaver.min.js","../src/SimpleMapScreenshoter.js","src/index.js"],"names":["SimpleMapScreenshoter","global","toSvg","node","options","domtoimage","impl","imagePlaceholder","defaultOptions","cacheBust","useCredentials","copyOptions","Promise","resolve","then","filter","root","HTMLCanvasElement","util","makeImage","toDataURL","cloneNode","clone","original","children","childNodes","length","parent","done","forEach","child","childClone","appendChild","asArray","cloneChildren","Element","source","target","cssText","font","name","setProperty","getPropertyValue","getPropertyPriority","window","getComputedStyle","style","clonePseudoElement","element","content","className","uid","currentClass","getAttribute","setAttribute","styleElement","document","createElement","selector","map","join","createTextNode","HTMLTextAreaElement","innerHTML","value","HTMLInputElement","SVGElement","SVGRectElement","attribute","processClone","embedFonts","inlineImages","bgcolor","backgroundColor","width","height","Object","keys","property","XMLSerializer","serializeToString","escapeXhtml","xhtml","foreignObject","svg","makeSvgDataUri","draw","domNode","delay","image","scale","canvas","ctx","getContext","fillStyle","fillRect","newCanvas","drawImage","makeNodeCopy","cloneStyle","clonePseudoElements","formatProperty","copyUserInput","fixSvg","fontFaces","resolveAll","styleNode","images","inlineAll","parseExtension","url","match","exec","px","styleProperty","parseFloat","replace","escape","string","mimeType","extension","toLowerCase","WOFF","woff","woff2","ttf","eot","png","jpg","jpeg","gif","tiff","mimes","dataAsUrl","type","isDataUrl","search","canvasToBlob","toBlob","binaryString","atob","split","binaryArray","Uint8Array","i","charCodeAt","Blob","resolveUrl","baseUrl","doc","implementation","createHTMLDocument","base","head","a","body","href","getAndEncode","TIMEOUT","test","Date","getTime","fail","message","console","error","placeholder","request","XMLHttpRequest","onreadystatechange","readyState","status","encoder","FileReader","onloadend","result","readAsDataURL","response","ontimeout","responseType","timeout","withCredentials","open","send","index","Math","random","pow","toString","slice","ms","arg","setTimeout","arrayLike","array","push","uri","reject","Image","crossOrigin","onload","onerror","src","leftBorder","rightBorder","scrollWidth","topBorder","bottomBorder","scrollHeight","inliner","shouldProcess","URL_REGEX","readUrls","inline","get","data","dataUrl","RegExp","urlAsRegex","urls","readAll","newWebFont","webFontRule","parentStyleSheet","styleSheets","cssRules","sheet","hasOwnProperty","bind","e","log","rule","CSSRule","FONT_FACE_RULE","rules","webFonts","all","webFont","cssStrings","newImage","background","inlined","HTMLImageElement","toPng","toJpeg","quality","toPixelData","getImageData","toCanvas","module","b","this","c","d","dispatchEvent","MouseEvent","createEvent","initMouseEvent","f","self","saveAs","HTMLAnchorElement","prototype","g","h","URL","webkitURL","j","download","rel","origin","location","createObjectURL","revokeObjectURL","navigator","msSaveOrOpenBlob","autoBom","warn","title","innerText","HTMLElement","safari","userAgent","k","l","L","Control","extend","_container","DomUtil","create","_link","_screenState","hidden","_addScreenBtn","format","sreenOptions","opt","promise","_map","fire","_setElementsVisible","_getPixelData","_this","_toCanvas","pixels","_canvasToImage","_canvasToBlob","catch","isVisible","hideElementsWithSelectors","els","_this2","querySelectorAll","opacity","indexOf","Error","blob","captionOffset","caption","captionFontSize","captionFont","captionColor","captionBgColor","_node","screenHeight","screenWidth","imageData","createImageData","putImageData","transformedCanvas","transformedCanvasCtx","minY","minX","cropImageByInnerWH","emptyYLine","emptyCountOnHorizontal","y","x","minMaxY","_getMinAndMaxOnValuesBreak","min","maxX","maxY","max","emptyXLine","emptyCountOnVertical","minMaxX","debugMode","debugX","debugY","onCropBorderSize","captionTxt","call","beginPath","rect","fill","save","fillText","arr","hasBreak","domtoimageOptions","_getPixelDataOfNormalMap","_this3","_getPixelDataOfBigMap","getContainer","mapPane","getPane","clientWidth","clientHeight","overflow","restoreMapPane","r","_this4","onPixelDataFail","_addCss","DomEvent","addListener","_onScreenBtn","disableClickPropagation","css","iconUrl","getElementsByTagName","preventDownload","takeScreen","screenName","_this5","simpleMapScreenshoter","_leafletSimpleMapScreenshoter","require","mapOptions","center","lat","lng","zoom","createPane","baselayer","tileLayer","maxZoom","subdomains","pane","addTo","snapshotOptions","screenshotter","takeScreenShot","imageSize","topLeft","img","imageurl","resultantImage","reader","base64String","fetch","method","headers","JSON","stringify","json","alert","button","getElementById","addEventListener"],"mappings":"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","file":"src.53d28fba.js","sourceRoot":"..","sourcesContent":["/* global L */\nimport SimpleMapScreenshoter from './SimpleMapScreenshoter'\n\n/**\n * @returns {L.Control.SimpleMapScreenshoter}\n */\nconst init = () => {\n    L.Control.SimpleMapScreenshoter = SimpleMapScreenshoter\n    L.simpleMapScreenshoter = function (options) {\n        return new L.Control.SimpleMapScreenshoter(options)\n    }\n    return SimpleMapScreenshoter\n}\n\nexport default init()\n\nexport {SimpleMapScreenshoter}\n","(function(global) {\n    'use strict';\n\n    var util = newUtil();\n    var inliner = newInliner();\n    var fontFaces = newFontFaces();\n    var images = newImages();\n\n    // Default impl options\n    var defaultOptions = {\n        // Default is to fail on error, no placeholder\n        imagePlaceholder: undefined,\n        // Default cache bust is false, it will use the cache\n        cacheBust: false,\n        // Use (existing) authentication credentials for external URIs (CORS requests)\n        useCredentials: false\n    };\n\n    var domtoimage = {\n        toSvg: toSvg,\n        toPng: toPng,\n        toJpeg: toJpeg,\n        toBlob: toBlob,\n        toPixelData: toPixelData,\n        toCanvas: toCanvas,\n        impl: {\n            fontFaces: fontFaces,\n            images: images,\n            util: util,\n            inliner: inliner,\n            options: {}\n        }\n    };\n\n    if (typeof exports === \"object\" && typeof module === \"object\")\n        module.exports = domtoimage;\n    else\n        global.domtoimage = domtoimage;\n\n    /**\n     * @param {Node} node - The DOM Node object to render\n     * @param {Object} options - Rendering options\n     * @param {Function} options.filter - Should return true if passed node should be included in the output\n     *          (excluding node means excluding it's children as well). Not called on the root node.\n     * @param {String} options.bgcolor - color for the background, any valid CSS color value.\n     * @param {Number} options.width - width to be applied to node before rendering.\n     * @param {Number} options.height - height to be applied to node before rendering.\n     * @param {Object} options.style - an object whose properties to be copied to node's style before rendering.\n     * @param {Number} options.quality - a Number between 0 and 1 indicating image quality (applicable to JPEG only),\n                defaults to 1.0.\n     * @param {Number} options.scale - a Number multiplier to scale up the canvas before rendering to reduce fuzzy images, defaults to 1.0.\n     * @param {String} options.imagePlaceholder - dataURL to use as a placeholder for failed images, default behaviour is to fail fast on images we can't fetch\n     * @param {Boolean} options.cacheBust - set to true to cache bust by appending the time to the request url\n     * @return {Promise} - A promise that is fulfilled with a SVG image data URL\n     * */\n    function toSvg(node, options) {\n        options = options || {};\n        copyOptions(options);\n        return Promise.resolve(node)\n            .then(function(node) {\n                return cloneNode(node, options.filter, true);\n            })\n            .then(embedFonts)\n            .then(inlineImages)\n            .then(applyOptions)\n            .then(function(clone) {\n                return makeSvgDataUri(clone,\n                    options.width || util.width(node),\n                    options.height || util.height(node)\n                );\n            });\n\n        function applyOptions(clone) {\n            if (options.bgcolor) clone.style.backgroundColor = options.bgcolor;\n            if (options.width) clone.style.width = options.width + 'px';\n            if (options.height) clone.style.height = options.height + 'px';\n\n            if (options.style)\n                Object.keys(options.style).forEach(function(property) {\n                    clone.style[property] = options.style[property];\n                });\n\n            return clone;\n        }\n    }\n\n    /**\n     * @param {Node} node - The DOM Node object to render\n     * @param {Object} options - Rendering options, @see {@link toSvg}\n     * @return {Promise} - A promise that is fulfilled with a Uint8Array containing RGBA pixel data.\n     * */\n    function toPixelData(node, options) {\n        return draw(node, options || {})\n            .then(function(canvas) {\n                return canvas.getContext('2d').getImageData(\n                    0,\n                    0,\n                    util.width(node),\n                    util.height(node)\n                ).data;\n            });\n    }\n\n    /**\n     * @param {Node} node - The DOM Node object to render\n     * @param {Object} options - Rendering options, @see {@link toSvg}\n     * @return {Promise} - A promise that is fulfilled with a PNG image data URL\n     * */\n    function toPng(node, options) {\n        return draw(node, options || {})\n            .then(function(canvas) {\n                return canvas.toDataURL();\n            });\n    }\n\n    /**\n     * @param {Node} node - The DOM Node object to render\n     * @param {Object} options - Rendering options, @see {@link toSvg}\n     * @return {Promise} - A promise that is fulfilled with a JPEG image data URL\n     * */\n    function toJpeg(node, options) {\n        options = options || {};\n        return draw(node, options)\n            .then(function(canvas) {\n                return canvas.toDataURL('image/jpeg', options.quality || 1.0);\n            });\n    }\n\n    /**\n     * @param {Node} node - The DOM Node object to render\n     * @param {Object} options - Rendering options, @see {@link toSvg}\n     * @return {Promise} - A promise that is fulfilled with a PNG image blob\n     * */\n    function toBlob(node, options) {\n        return draw(node, options || {})\n            .then(util.canvasToBlob);\n    }\n\n    /**\n     * @param {Node} node - The DOM Node object to render\n     * @param {Object} options - Rendering options, @see {@link toSvg}\n     * @return {Promise} - A promise that is fulfilled with a canvas object\n     * */\n    function toCanvas(node, options) {\n        return draw(node, options || {});\n    }\n\n    function copyOptions(options) {\n        // Copy options to impl options for use in impl\n        if (typeof(options.imagePlaceholder) === 'undefined') {\n            domtoimage.impl.options.imagePlaceholder = defaultOptions.imagePlaceholder;\n        } else {\n            domtoimage.impl.options.imagePlaceholder = options.imagePlaceholder;\n        }\n\n        if (typeof(options.cacheBust) === 'undefined') {\n            domtoimage.impl.options.cacheBust = defaultOptions.cacheBust;\n        } else {\n            domtoimage.impl.options.cacheBust = options.cacheBust;\n        }\n\n        if(typeof(options.useCredentials) === 'undefined') {\n            domtoimage.impl.options.useCredentials = defaultOptions.useCredentials;\n        } else {\n            domtoimage.impl.options.useCredentials = options.useCredentials;\n        }\n    }\n\n    function draw(domNode, options) {\n        return toSvg(domNode, options)\n            .then(util.makeImage)\n            .then(util.delay(100))\n            .then(function(image) {\n                var scale = typeof(options.scale) !== 'number' ? 1 : options.scale;\n                var canvas = newCanvas(domNode, scale);\n                var ctx = canvas.getContext('2d');\n                if (image) {\n                    ctx.scale(scale, scale);\n                    ctx.drawImage(image, 0, 0);\n                }\n                return canvas;\n            });\n\n        function newCanvas(domNode, scale) {\n            var canvas = document.createElement('canvas');\n            canvas.width = (options.width || util.width(domNode)) * scale;\n            canvas.height = (options.height || util.height(domNode)) * scale;\n\n            if (options.bgcolor) {\n                var ctx = canvas.getContext('2d');\n                ctx.fillStyle = options.bgcolor;\n                ctx.fillRect(0, 0, canvas.width, canvas.height);\n            }\n\n            return canvas;\n        }\n    }\n\n    function cloneNode(node, filter, root) {\n        if (!root && filter && !filter(node)) return Promise.resolve();\n\n        return Promise.resolve(node)\n            .then(makeNodeCopy)\n            .then(function(clone) {\n                return cloneChildren(node, clone, filter);\n            })\n            .then(function(clone) {\n                return processClone(node, clone);\n            });\n\n        function makeNodeCopy(node) {\n            if (node instanceof HTMLCanvasElement) return util.makeImage(node.toDataURL());\n            return node.cloneNode(false);\n        }\n\n        function cloneChildren(original, clone, filter) {\n            var children = original.childNodes;\n            if (children.length === 0) return Promise.resolve(clone);\n\n            return cloneChildrenInOrder(clone, util.asArray(children), filter)\n                .then(function() {\n                    return clone;\n                });\n\n            function cloneChildrenInOrder(parent, children, filter) {\n                var done = Promise.resolve();\n                children.forEach(function(child) {\n                    done = done\n                        .then(function() {\n                            return cloneNode(child, filter);\n                        })\n                        .then(function(childClone) {\n                            if (childClone) parent.appendChild(childClone);\n                        });\n                });\n                return done;\n            }\n        }\n\n        function processClone(original, clone) {\n            if (!(clone instanceof Element)) return clone;\n\n            return Promise.resolve()\n                .then(cloneStyle)\n                .then(clonePseudoElements)\n                .then(copyUserInput)\n                .then(fixSvg)\n                .then(function() {\n                    return clone;\n                });\n\n            function cloneStyle() {\n                copyStyle(window.getComputedStyle(original), clone.style);\n\n                function copyStyle(source, target) {\n                    if (source.cssText) {\n                        target.cssText = source.cssText;\n                        target.font = source.font; // here, we re-assign the font prop.\n                    } else copyProperties(source, target);\n\n                    function copyProperties(source, target) {\n                        util.asArray(source).forEach(function(name) {\n                            target.setProperty(\n                                name,\n                                source.getPropertyValue(name),\n                                source.getPropertyPriority(name)\n                            );\n                        });\n                    }\n                }\n            }\n\n            function clonePseudoElements() {\n                [':before', ':after'].forEach(function(element) {\n                    clonePseudoElement(element);\n                });\n\n                function clonePseudoElement(element) {\n                    var style = window.getComputedStyle(original, element);\n                    var content = style.getPropertyValue('content');\n\n                    if (content === '' || content === 'none') return;\n\n                    var className = util.uid();\n                    var currentClass = clone.getAttribute('class');\n                    if (currentClass) {\n                        clone.setAttribute('class', currentClass + ' ' + className);\n                    }\n\n                    var styleElement = document.createElement('style');\n                    styleElement.appendChild(formatPseudoElementStyle(className, element, style));\n                    clone.appendChild(styleElement);\n\n                    function formatPseudoElementStyle(className, element, style) {\n                        var selector = '.' + className + ':' + element;\n                        var cssText = style.cssText ? formatCssText(style) : formatCssProperties(style);\n                        return document.createTextNode(selector + '{' + cssText + '}');\n\n                        function formatCssText(style) {\n                            var content = style.getPropertyValue('content');\n                            return style.cssText + ' content: ' + content + ';';\n                        }\n\n                        function formatCssProperties(style) {\n\n                            return util.asArray(style)\n                                .map(formatProperty)\n                                .join('; ') + ';';\n\n                            function formatProperty(name) {\n                                return name + ': ' +\n                                    style.getPropertyValue(name) +\n                                    (style.getPropertyPriority(name) ? ' !important' : '');\n                            }\n                        }\n                    }\n                }\n            }\n\n            function copyUserInput() {\n                if (original instanceof HTMLTextAreaElement) clone.innerHTML = original.value;\n                if (original instanceof HTMLInputElement) clone.setAttribute(\"value\", original.value);\n            }\n\n            function fixSvg() {\n                if (!(clone instanceof SVGElement)) return;\n                clone.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\n\n                if (!(clone instanceof SVGRectElement)) return;\n                ['width', 'height'].forEach(function(attribute) {\n                    var value = clone.getAttribute(attribute);\n                    if (!value) return;\n\n                    clone.style.setProperty(attribute, value);\n                });\n            }\n        }\n    }\n\n    function embedFonts(node) {\n        return fontFaces.resolveAll()\n            .then(function(cssText) {\n                var styleNode = document.createElement('style');\n                node.appendChild(styleNode);\n                styleNode.appendChild(document.createTextNode(cssText));\n                return node;\n            });\n    }\n\n    function inlineImages(node) {\n        return images.inlineAll(node)\n            .then(function() {\n                return node;\n            });\n    }\n\n    function makeSvgDataUri(node, width, height) {\n        return Promise.resolve(node)\n            .then(function(node) {\n                node.setAttribute('xmlns', 'http://www.w3.org/1999/xhtml');\n                return new XMLSerializer().serializeToString(node);\n            })\n            .then(util.escapeXhtml)\n            .then(function(xhtml) {\n                return '<foreignObject x=\"0\" y=\"0\" width=\"100%\" height=\"100%\">' + xhtml + '</foreignObject>';\n            })\n            .then(function(foreignObject) {\n                return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"' + width + '\" height=\"' + height + '\">' +\n                    foreignObject + '</svg>';\n            })\n            .then(function(svg) {\n                return 'data:image/svg+xml;charset=utf-8,' + svg;\n            });\n    }\n\n    function newUtil() {\n        return {\n            escape: escape,\n            parseExtension: parseExtension,\n            mimeType: mimeType,\n            dataAsUrl: dataAsUrl,\n            isDataUrl: isDataUrl,\n            canvasToBlob: canvasToBlob,\n            resolveUrl: resolveUrl,\n            getAndEncode: getAndEncode,\n            uid: uid(),\n            delay: delay,\n            asArray: asArray,\n            escapeXhtml: escapeXhtml,\n            makeImage: makeImage,\n            width: width,\n            height: height\n        };\n\n        function mimes() {\n            /*\n             * Only WOFF and EOT mime types for fonts are 'real'\n             * see http://www.iana.org/assignments/media-types/media-types.xhtml\n             */\n            var WOFF = 'application/font-woff';\n            var JPEG = 'image/jpeg';\n\n            return {\n                'woff': WOFF,\n                'woff2': WOFF,\n                'ttf': 'application/font-truetype',\n                'eot': 'application/vnd.ms-fontobject',\n                'png': 'image/png',\n                'jpg': JPEG,\n                'jpeg': JPEG,\n                'gif': 'image/gif',\n                'tiff': 'image/tiff',\n                'svg': 'image/svg+xml'\n            };\n        }\n\n        function parseExtension(url) {\n            var match = /\\.([^\\.\\/]*?)(\\?|$)/g.exec(url);\n            if (match) return match[1];\n            else return '';\n        }\n\n        function mimeType(url) {\n            var extension = parseExtension(url).toLowerCase();\n            return mimes()[extension] || '';\n        }\n\n        function isDataUrl(url) {\n            return url.search(/^(data:)/) !== -1;\n        }\n\n        function toBlob(canvas) {\n            return new Promise(function(resolve) {\n                var binaryString = window.atob(canvas.toDataURL().split(',')[1]);\n                var length = binaryString.length;\n                var binaryArray = new Uint8Array(length);\n\n                for (var i = 0; i < length; i++)\n                    binaryArray[i] = binaryString.charCodeAt(i);\n\n                resolve(new Blob([binaryArray], {\n                    type: 'image/png'\n                }));\n            });\n        }\n\n        function canvasToBlob(canvas) {\n            if (canvas.toBlob)\n                return new Promise(function(resolve) {\n                    canvas.toBlob(resolve);\n                });\n\n            return toBlob(canvas);\n        }\n\n        function resolveUrl(url, baseUrl) {\n            var doc = document.implementation.createHTMLDocument();\n            var base = doc.createElement('base');\n            doc.head.appendChild(base);\n            var a = doc.createElement('a');\n            doc.body.appendChild(a);\n            base.href = baseUrl;\n            a.href = url;\n            return a.href;\n        }\n\n        function uid() {\n            var index = 0;\n\n            return function() {\n                return 'u' + fourRandomChars() + index++;\n\n                function fourRandomChars() {\n                    /* see http://stackoverflow.com/a/6248722/2519373 */\n                    return ('0000' + (Math.random() * Math.pow(36, 4) << 0).toString(36)).slice(-4);\n                }\n            };\n        }\n\n        function makeImage(uri) {\n            if (uri === 'data:,') return Promise.resolve();\n            return new Promise(function(resolve, reject) {\n                var image = new Image();\n                if(domtoimage.impl.options.useCredentials) {\n                    image.crossOrigin = 'use-credentials';\n                }\n                image.onload = function() {\n                    resolve(image);\n                };\n                image.onerror = reject;\n                image.src = uri;\n            });\n        }\n\n        function getAndEncode(url) {\n            var TIMEOUT = 30000;\n            if (domtoimage.impl.options.cacheBust) {\n                // Cache bypass so we dont have CORS issues with cached images\n                // Source: https://developer.mozilla.org/en/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest#Bypassing_the_cache\n                url += ((/\\?/).test(url) ? \"&\" : \"?\") + (new Date()).getTime();\n            }\n\n            return new Promise(function(resolve) {\n                var request = new XMLHttpRequest();\n\n                request.onreadystatechange = done;\n                request.ontimeout = timeout;\n                request.responseType = 'blob';\n                request.timeout = TIMEOUT;\n                if(domtoimage.impl.options.useCredentials) {\n                    request.withCredentials = true;\n                }\n                request.open('GET', url, true);\n                request.send();\n\n                var placeholder;\n                if (domtoimage.impl.options.imagePlaceholder) {\n                    var split = domtoimage.impl.options.imagePlaceholder.split(/,/);\n                    if (split && split[1]) {\n                        placeholder = split[1];\n                    }\n                }\n\n                function done() {\n                    if (request.readyState !== 4) return;\n\n                    if (request.status !== 200) {\n                        if (placeholder) {\n                            resolve(placeholder);\n                        } else {\n                            fail('cannot fetch resource: ' + url + ', status: ' + request.status);\n                        }\n\n                        return;\n                    }\n\n                    var encoder = new FileReader();\n                    encoder.onloadend = function() {\n                        var content = encoder.result.split(/,/)[1];\n                        resolve(content);\n                    };\n                    encoder.readAsDataURL(request.response);\n                }\n\n                function timeout() {\n                    if (placeholder) {\n                        resolve(placeholder);\n                    } else {\n                        fail('timeout of ' + TIMEOUT + 'ms occured while fetching resource: ' + url);\n                    }\n                }\n\n                function fail(message) {\n                    console.error(message);\n                    resolve('');\n                }\n            });\n        }\n\n        function dataAsUrl(content, type) {\n            return 'data:' + type + ';base64,' + content;\n        }\n\n        function escape(string) {\n            return string.replace(/([.*+?^${}()|\\[\\]\\/\\\\])/g, '\\\\$1');\n        }\n\n        function delay(ms) {\n            return function(arg) {\n                return new Promise(function(resolve) {\n                    setTimeout(function() {\n                        resolve(arg);\n                    }, ms);\n                });\n            };\n        }\n\n        function asArray(arrayLike) {\n            var array = [];\n            var length = arrayLike.length;\n            for (var i = 0; i < length; i++) array.push(arrayLike[i]);\n            return array;\n        }\n\n        function escapeXhtml(string) {\n            return string.replace(/#/g, '%23').replace(/\\n/g, '%0A');\n        }\n\n        function width(node) {\n            var leftBorder = px(node, 'border-left-width');\n            var rightBorder = px(node, 'border-right-width');\n            return node.scrollWidth + leftBorder + rightBorder;\n        }\n\n        function height(node) {\n            var topBorder = px(node, 'border-top-width');\n            var bottomBorder = px(node, 'border-bottom-width');\n            return node.scrollHeight + topBorder + bottomBorder;\n        }\n\n        function px(node, styleProperty) {\n            var value = window.getComputedStyle(node).getPropertyValue(styleProperty);\n            return parseFloat(value.replace('px', ''));\n        }\n    }\n\n    function newInliner() {\n        var URL_REGEX = /url\\(['\"]?([^'\"]+?)['\"]?\\)/g;\n\n        return {\n            inlineAll: inlineAll,\n            shouldProcess: shouldProcess,\n            impl: {\n                readUrls: readUrls,\n                inline: inline\n            }\n        };\n\n        function shouldProcess(string) {\n            return string.search(URL_REGEX) !== -1;\n        }\n\n        function readUrls(string) {\n            var result = [];\n            var match;\n            while ((match = URL_REGEX.exec(string)) !== null) {\n                result.push(match[1]);\n            }\n            return result.filter(function(url) {\n                return !util.isDataUrl(url);\n            });\n        }\n\n        function inline(string, url, baseUrl, get) {\n            return Promise.resolve(url)\n                .then(function(url) {\n                    return baseUrl ? util.resolveUrl(url, baseUrl) : url;\n                })\n                .then(get || util.getAndEncode)\n                .then(function(data) {\n                    return util.dataAsUrl(data, util.mimeType(url));\n                })\n                .then(function(dataUrl) {\n                    return string.replace(urlAsRegex(url), '$1' + dataUrl + '$3');\n                });\n\n            function urlAsRegex(url) {\n                return new RegExp('(url\\\\([\\'\"]?)(' + util.escape(url) + ')([\\'\"]?\\\\))', 'g');\n            }\n        }\n\n        function inlineAll(string, baseUrl, get) {\n            if (nothingToInline()) return Promise.resolve(string);\n\n            return Promise.resolve(string)\n                .then(readUrls)\n                .then(function(urls) {\n                    var done = Promise.resolve(string);\n                    urls.forEach(function(url) {\n                        done = done.then(function(string) {\n                            return inline(string, url, baseUrl, get);\n                        });\n                    });\n                    return done;\n                });\n\n            function nothingToInline() {\n                return !shouldProcess(string);\n            }\n        }\n    }\n\n    function newFontFaces() {\n        return {\n            resolveAll: resolveAll,\n            impl: {\n                readAll: readAll\n            }\n        };\n\n        function resolveAll() {\n            return readAll(document)\n                .then(function(webFonts) {\n                    return Promise.all(\n                        webFonts.map(function(webFont) {\n                            return webFont.resolve();\n                        })\n                    );\n                })\n                .then(function(cssStrings) {\n                    return cssStrings.join('\\n');\n                });\n        }\n\n        function readAll() {\n            return Promise.resolve(util.asArray(document.styleSheets))\n                .then(getCssRules)\n                .then(selectWebFontRules)\n                .then(function(rules) {\n                    return rules.map(newWebFont);\n                });\n\n            function selectWebFontRules(cssRules) {\n                return cssRules\n                    .filter(function(rule) {\n                        return rule.type === CSSRule.FONT_FACE_RULE;\n                    })\n                    .filter(function(rule) {\n                        return inliner.shouldProcess(rule.style.getPropertyValue('src'));\n                    });\n            }\n\n            function getCssRules(styleSheets) {\n                var cssRules = [];\n                styleSheets.forEach(function(sheet) {\n                    if (sheet.hasOwnProperty(\"cssRules\")) {\n                        try {\n                            util.asArray(sheet.cssRules || []).forEach(cssRules.push.bind(cssRules));\n                        } catch (e) {\n                            console.log('Error while reading CSS rules from ' + sheet.href, e.toString());\n                        }\n                    }\n                });\n                return cssRules;\n            }\n\n            function newWebFont(webFontRule) {\n                return {\n                    resolve: function resolve() {\n                        var baseUrl = (webFontRule.parentStyleSheet || {}).href;\n                        return inliner.inlineAll(webFontRule.cssText, baseUrl);\n                    },\n                    src: function() {\n                        return webFontRule.style.getPropertyValue('src');\n                    }\n                };\n            }\n        }\n    }\n\n    function newImages() {\n        return {\n            inlineAll: inlineAll,\n            impl: {\n                newImage: newImage\n            }\n        };\n\n        function newImage(element) {\n            return {\n                inline: inline\n            };\n\n            function inline(get) {\n                if (util.isDataUrl(element.src)) return Promise.resolve();\n\n                return Promise.resolve(element.src)\n                    .then(get || util.getAndEncode)\n                    .then(function(data) {\n                        return util.dataAsUrl(data, util.mimeType(element.src));\n                    })\n                    .then(function(dataUrl) {\n                        return new Promise(function(resolve, reject) {\n                            element.onload = resolve;\n                            // for any image with invalid src(such as <img src />), just ignore it\n                            element.onerror = resolve;\n                            element.src = dataUrl;\n                        });\n                    });\n            }\n        }\n\n        function inlineAll(node) {\n            if (!(node instanceof Element)) return Promise.resolve(node);\n\n            return inlineBackground(node)\n                .then(function() {\n                    if (node instanceof HTMLImageElement)\n                        return newImage(node).inline();\n                    else\n                        return Promise.all(\n                            util.asArray(node.childNodes).map(function(child) {\n                                return inlineAll(child);\n                            })\n                        );\n                });\n\n            function inlineBackground(node) {\n                var background = node.style.getPropertyValue('background');\n\n                if (!background) return Promise.resolve(node);\n\n                return inliner.inlineAll(background)\n                    .then(function(inlined) {\n                        node.style.setProperty(\n                            'background',\n                            inlined,\n                            node.style.getPropertyPriority('background')\n                        );\n                    })\n                    .then(function() {\n                        return node;\n                    });\n            }\n        }\n    }\n})(this);\n","(function(a,b){if(\"function\"==typeof define&&define.amd)define([],b);else if(\"undefined\"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){\"use strict\";function b(a,b){return\"undefined\"==typeof b?b={autoBom:!1}:\"object\"!=typeof b&&(console.warn(\"Deprecated: Expected third argument to be a object\"),b={autoBom:!b}),b.autoBom&&/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(a.type)?new Blob([\"\\uFEFF\",a],{type:a.type}):a}function c(b,c,d){var e=new XMLHttpRequest;e.open(\"GET\",b),e.responseType=\"blob\",e.onload=function(){a(e.response,c,d)},e.onerror=function(){console.error(\"could not download file\")},e.send()}function d(a){var b=new XMLHttpRequest;b.open(\"HEAD\",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent(\"click\"))}catch(c){var b=document.createEvent(\"MouseEvents\");b.initMouseEvent(\"click\",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f=\"object\"==typeof window&&window.window===window?window:\"object\"==typeof self&&self.self===self?self:\"object\"==typeof global&&global.global===global?global:void 0,a=f.saveAs||(\"object\"!=typeof window||window!==f?function(){}:\"download\"in HTMLAnchorElement.prototype?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement(\"a\");g=g||b.name||\"download\",j.download=g,j.rel=\"noopener\",\"string\"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target=\"_blank\")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:\"msSaveOrOpenBlob\"in navigator?function(f,g,h){if(g=g||f.name||\"download\",\"string\"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement(\"a\");i.href=f,i.target=\"_blank\",setTimeout(function(){e(i)})}}:function(a,b,d,e){if(e=e||open(\"\",\"_blank\"),e&&(e.document.title=e.document.body.innerText=\"downloading...\"),\"string\"==typeof a)return c(a,b,d);var g=\"application/octet-stream\"===a.type,h=/constructor/i.test(f.HTMLElement)||f.safari,i=/CriOS\\/[\\d]+/.test(navigator.userAgent);if((i||g&&h)&&\"object\"==typeof FileReader){var j=new FileReader;j.onloadend=function(){var a=j.result;a=i?a:a.replace(/^data:[^;]*;/,\"data:attachment/file;\"),e?e.location.href=a:location=a,e=null},j.readAsDataURL(a)}else{var k=f.URL||f.webkitURL,l=k.createObjectURL(a);e?e.location=l:location.href=l,e=null,setTimeout(function(){k.revokeObjectURL(l)},4E4)}});f.saveAs=a.saveAs=a,\"undefined\"!=typeof module&&(module.exports=a)});\n\n//# sourceMappingURL=FileSaver.min.js.map","/* global L */\nimport domtoimage from 'dom-to-image-more'\nimport fileSaver from 'file-saver'\n\nexport const STATUS_READY = 1\nexport const STATUS_PENDING = 2\nexport const ICON_SVG_BASE64 = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/PjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDMyIDMyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAzMiAzMjsiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxnPjxnIGlkPSJjYW1lcmEiPjxwYXRoIHN0eWxlPSJmaWxsOiMwMTAwMDI7IiBkPSJNMTYsOS41MDFjLTQuNDE5LDAtOCwzLjU4MS04LDhjMCw0LjQxOCwzLjU4MSw4LDgsOGM0LjQxOCwwLDgtMy41ODIsOC04UzIwLjQxOCw5LjUwMSwxNiw5LjUwMXogTTIwLjU1NSwyMS40MDZjLTIuMTU2LDIuNTE2LTUuOTQzLDIuODA3LTguNDU5LDAuNjVjLTIuNTE3LTIuMTU2LTIuODA3LTUuOTQ0LTAuNjUtOC40NTljMi4xNTUtMi41MTcsNS45NDMtMi44MDcsOC40NTktMC42NUMyMi40MiwxNS4xMDIsMjIuNzExLDE4Ljg5MSwyMC41NTUsMjEuNDA2eiIvPjxwYXRoIHN0eWxlPSJmaWxsOiMwMTAwMDI7IiBkPSJNMTYsMTMuNTAxYy0yLjIwOSwwLTMuOTk5LDEuNzkxLTQsMy45OTl2MC4wMDJjMCwwLjI3NSwwLjIyNCwwLjUsMC41LDAuNXMwLjUtMC4yMjUsMC41LTAuNVYxNy41YzAuMDAxLTEuNjU2LDEuMzQzLTIuOTk5LDMtMi45OTljMC4yNzYsMCwwLjUtMC4yMjQsMC41LTAuNVMxNi4yNzYsMTMuNTAxLDE2LDEzLjUwMXoiLz48cGF0aCBzdHlsZT0iZmlsbDojMDEwMDAyOyIgZD0iTTI5LjQ5Miw4LjU0MmwtNC4zMzQtMC43MjNsLTEuMzczLTMuNDM0QzIzLjMyNiwzLjI0LDIyLjIzMiwyLjUsMjEsMi41SDExYy0xLjIzMiwwLTIuMzI2LDAuNzQtMi43ODYsMS44ODZMNi44NDIsNy44MTlMMi41MDksOC41NDJDMS4wNTUsOC43ODMsMCwxMC4wMjcsMCwxMS41djE1YzAsMS42NTQsMS4zNDYsMywzLDNoMjZjMS42NTQsMCwzLTEuMzQ2LDMtM3YtMTVDMzIsMTAuMDI3LDMwLjk0NSw4Ljc4MywyOS40OTIsOC41NDJ6IE0zMCwyNi41YzAsMC41NTMtMC40NDcsMS0xLDFIM2MtMC41NTMsMC0xLTAuNDQ3LTEtMXYtMTVjMC0wLjQ4OSwwLjM1NC0wLjkwNiwwLjgzNi0wLjk4Nkw4LjI4LDkuNjA3bDEuNzkxLTQuNDc4QzEwLjIyNCw0Ljc1LDEwLjU5MSw0LjUsMTEsNC41aDEwYzAuNDA4LDAsMC43NzUsMC4yNDksMC45MjgsMC42MjlsMS43OTEsNC40NzhsNS40NDUsMC45MDdDMjkuNjQ2LDEwLjU5NCwzMCwxMS4wMTEsMzAsMTEuNVYyNi41eiIvPjwvZz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PC9zdmc+'\n\nexport const SimpleMapScreenshoter = L.Control.extend({\n    options: {\n        cropImageByInnerWH: true,\n        hidden: false,\n        domtoimageOptions: {},\n        position: 'topleft',\n        screenName: 'screen',\n        iconUrl: ICON_SVG_BASE64,\n        hideElementsWithSelectors: [\n            '.leaflet-control-container'\n        ],\n        onCropBorderSize: 2,\n        caption: null,\n        captionFontSize: 15,\n        captionFont: 'Arial',\n        captionColor: 'black',\n        captionBgColor: 'white',\n        captionOffset: 5,\n        mimeType: 'image/png',\n        debugMode: false,\n        preventDownload: false,\n        onPixelDataFail: function ({ node, error }) {\n            console.warn(`Map node is very big ${node.scrollWidth}x${node.scrollHeight}`)\n            console.warn(`Add function: SimpleMapScreenshoter({\n              onPixelDataFail: function({ node, plugin, error, mapPane, domtoimageOptions }) {\n                 // Solutions:\n                 // decrease size of map\n                 // or decrease zoom level\n                 // or remove elements with big distanses\n                 // and after that return image in Promise - plugin._getPixelDataOfNormalMap\n                 return plugin._getPixelDataOfNormalMap(domtoimageOptions)\n              }\n            })`)\n            return Promise.reject(error)\n        }\n    },\n    onAdd () {\n        this._container = L.DomUtil.create(\n            'div',\n            'leaflet-control-simpleMapScreenshoter'\n        )\n        this._link = null\n        this._screenState = {\n            status: STATUS_READY,\n            promise: null\n        }\n        if (this.options.hidden === false) {\n            this._addScreenBtn()\n        }\n        return this._container\n    },\n    /**\n     * @param format {string} blob or png\n     * @param sreenOptions {Object}\n     * @returns {Promise<Blob>|Promise<Base64>} Blob or png image\n     */\n    takeScreen (format = 'blob', sreenOptions = {}) {\n        const options = {}\n        for (let opt in this.options) {\n            if (sreenOptions.hasOwnProperty(opt)) {\n                options[opt] = sreenOptions[opt]\n            } else {\n                options[opt] = this.options[opt]\n            }\n        }\n        if (this._screenState.status === STATUS_PENDING) {\n            return this._screenState.promise\n        }\n        this._map.fire('simpleMapScreenshoter.takeScreen')\n        this._screenState.status = STATUS_PENDING\n        this._setElementsVisible(false)\n        this._screenState.promise = this._getPixelData(options)\n            .then(pixels => {\n                this._setElementsVisible(true)\n                return this._toCanvas(pixels, options)\n            })\n            .then(canvas => {\n                if (format === 'image') {\n                    return this._canvasToImage(canvas, options)\n                } else if (format === 'canvas') {\n                    return canvas\n                }\n                return this._canvasToBlob(canvas)\n            })\n            .then(image => {\n                this._screenState.status = STATUS_READY\n                this._map.fire('simpleMapScreenshoter.done')\n                return image\n            }).catch(e => {\n                this._setElementsVisible(true)\n                this._screenState.status = STATUS_READY\n                this._map.fire('simpleMapScreenshoter.error', {e})\n                return Promise.reject(e)\n            })\n        return this._screenState.promise\n    },\n    /**\n     * @param isVisible\n     * @private\n     */\n    _setElementsVisible (isVisible = false) {\n        this.options.hideElementsWithSelectors.forEach(selector => {\n            const els = this._map._container.querySelectorAll(selector)\n            for (let el of els) {\n                el.style.opacity = isVisible === false\n                    ? 0\n                    : 1\n            }\n        })\n    },\n    /**\n     * @param canvas\n     * @param mimeType\n     * @returns {Promise<Base64>}\n     * @private\n     */\n    _canvasToImage (canvas, {mimeType}) {\n        const image = canvas.toDataURL(mimeType)\n        if (image.indexOf('base64') === -1) {\n            return Promise.reject(new Error('Base64 image generation error'))\n        }\n        return Promise.resolve(image)\n    },\n    /**\n     * @param canvas {Canvas}\n     * @returns {Promise<Blob>}\n     * @private\n     */\n    _canvasToBlob (canvas) {\n        return new Promise((resolve, reject) => {\n            canvas.toBlob(blob => {\n                resolve(blob)\n            }, 'image/png')\n        })\n    },\n    /**\n     * @param pixels {Uint8Array}\n     * @param options {Object}\n     * @returns {Promise<Canvas>}\n     * @private\n     */\n    _toCanvas (pixels, options) {\n        let {captionOffset, caption, captionFontSize, captionFont, captionColor, captionBgColor} = options\n        let {screenHeight, screenWidth} = this._node\n        let canvas = document.createElement('canvas')\n        canvas.width = screenWidth\n        canvas.height = screenHeight\n\n        let ctx = canvas.getContext('2d')\n        let imageData = ctx.createImageData(screenWidth, screenHeight)\n        for (let i = 0; i < pixels.length; ++i) {\n            imageData.data[i] = pixels[i]\n        }\n        ctx.putImageData(imageData, 0, 0)\n        imageData = null\n\n        let transformedCanvas = document.createElement('canvas')\n        let transformedCanvasCtx = transformedCanvas.getContext('2d')\n        let minY = 0\n        let minX = 0\n        let height = screenHeight\n        let width = screenWidth\n\n        // crop blank opacity from image borders\n        if (this.options.cropImageByInnerWH === true) {\n            let pixelAtXYOffset = 0\n\n            let debugY = {}\n            let debugX = {}\n\n            let emptyYLine = []\n            let emptyCountOnHorizontal = 0\n            for (let y = 0; y < screenHeight; ++y) {\n                emptyCountOnHorizontal = 0\n                for (let x = 0; x < screenWidth; ++x) {\n                    pixelAtXYOffset = (4 * y * screenWidth) + (4 * x)\n                    // find opacity = 0 on horizontal\n                    if (pixels[pixelAtXYOffset + 4] === 0) {\n                        emptyCountOnHorizontal++\n                    }\n                    /* if (y === Math.round(screenHeight / 2)) {\n                        debugY[x] = pixels.slice(pixelAtXYOffset, pixelAtXYOffset + 4)\n                    } */\n                }\n                // save empty horizontal\n                if (emptyCountOnHorizontal === screenWidth) {\n                    emptyYLine.push(y)\n                }\n            }\n            const minMaxY = this._getMinAndMaxOnValuesBreak(emptyYLine)\n            minY = minMaxY.min\n            let maxX = screenWidth\n            let maxY = minMaxY.max\n\n            let emptyXLine = []\n            let emptyCountOnVertical = 0\n            for (let x = minX; x < maxX; ++x) {\n                emptyCountOnVertical = 0\n                for (let y = 0; y < screenHeight; ++y) {\n                    pixelAtXYOffset = (4 * y * screenWidth) + (4 * x)\n                    // find opacity = 0 on vertical\n                    if (pixels[pixelAtXYOffset + 4] === 0) {\n                        emptyCountOnVertical++\n                    }\n\n                    /* if (x === screenWidth - 5) {\n                        debugX[y] = pixels.slice(pixelAtXYOffset, pixelAtXYOffset + 4)\n                    } */\n                }\n                // save empty vertical\n                if (emptyCountOnVertical === screenHeight) {\n                    emptyXLine.push(x)\n                }\n            }\n            const minMaxX = this._getMinAndMaxOnValuesBreak(emptyXLine)\n            minX = minMaxX.min\n            maxX = minMaxX.max\n\n            if ((minX === 0 && maxX === 0) || maxX === null) {\n                maxX = screenWidth\n            }\n            if ((minY === 0 && maxY === 0) || maxY === null) {\n                maxY = screenHeight\n            }\n\n            if (this.options.debugMode === true) {\n                console.log('emptyYLine', emptyYLine)\n                console.log('minMaxY', minMaxY)\n                console.log('emptyXLine', emptyXLine)\n                console.log('minMaxX', minMaxX)\n                console.log('debugX', debugX)\n                console.log('debugY', debugY)\n            }\n\n            // if w/h changed, scale inner\n            if (minY !== 0 || maxY !== screenHeight || minX !== 0 || maxX !== screenWidth) {\n                minY = minY + this.options.onCropBorderSize\n                maxY = maxY - this.options.onCropBorderSize\n                minX = minX + this.options.onCropBorderSize\n                maxX = maxX - this.options.onCropBorderSize\n            }\n            height = maxY - minY\n            width = maxX - minX\n            transformedCanvas.width = width\n            transformedCanvas.height = height\n        } else {\n            transformedCanvas.width = width\n            transformedCanvas.height = height\n        }\n\n        let captionTxt = null\n        if (caption) {\n            captionTxt = typeof caption === 'function'\n                ? caption.call(this)\n                : caption\n        }\n\n        // increase size of canvas for write caption\n        if (captionTxt !== null) {\n            transformedCanvas.height = transformedCanvas.height + (captionOffset + captionFontSize + captionOffset)\n            // set bg color\n            transformedCanvasCtx.beginPath()\n            transformedCanvasCtx.rect(0, 0, transformedCanvas.width, transformedCanvas.height)\n            transformedCanvasCtx.fillStyle = captionBgColor\n            transformedCanvasCtx.fill()\n            transformedCanvasCtx.save()\n        }\n\n        transformedCanvasCtx.drawImage(canvas, minX, minY, width, height, 0, 0, width, height)\n\n        // write caption text\n        if (captionTxt !== null) {\n            transformedCanvasCtx.font = `${captionFontSize}px ${captionFont}`\n            transformedCanvasCtx.fillStyle = captionColor\n            transformedCanvasCtx.fillText(captionTxt, captionOffset, height + captionOffset + captionFontSize)\n        }\n\n        return Promise.resolve(transformedCanvas)\n    },\n    /**\n     * find break in array [0,1,2,3,40,41,42]\n     * we get 3 and 40\n     * @param arr {Array}\n     * @returns {{min: number, max: number}}\n     * @private\n     */\n    _getMinAndMaxOnValuesBreak (arr) {\n        let min = 0\n        let max = 0\n        let hasBreak = false\n        for (let i = 1; i < arr.length; i++) {\n            if (arr[i] - 1 === arr[i - 1]) {\n                min = arr[i]\n            } else {\n                max = arr[i]\n                hasBreak = true\n                break\n            }\n        }\n        // if on start no opacity, opacity may be exist on end\n        if (hasBreak === false && arr[0] > 1) {\n            min = 0\n            max = arr[0]\n            // opaciy at start\n        } else if (hasBreak === false) {\n            min = arr[arr.length - 1] || 0\n            max = null\n        }\n        return {min, max}\n    },\n    /**\n     * @param domtoimageOptions\n     * @returns {Promise<Uint8Array>}\n     * @private\n     */\n    _getPixelData ({domtoimageOptions = {}}) {\n        /**\n         * 1) we try try to get full map size screen, but we have problem of big canvas:\n         * https://stackoverflow.com/questions/6081483/maximum-size-of-a-canvas-element\n         * ie mobile - 4000\n         * ie - 8000\n         * chrome - 16000\n         * firefox - 32000\n         *\n         * 2) on error, we can create screen with hide not visible elements by css\n         * sometimes it not work, need solution\n         */\n        return this._getPixelDataOfNormalMap(domtoimageOptions).catch(e => {\n            console.warn('May be map size very big on that zoom level, we have error:', e.toString())\n            console.warn('You can manually hide map elements with large distances between them for fix that warn')\n            return this._getPixelDataOfBigMap(domtoimageOptions)\n        })\n    },\n    _getPixelDataOfNormalMap (domtoimageOptions = {}) {\n        const node = this._map.getContainer()\n\n        this._node = {\n            node,\n            screenHeight: node.scrollHeight,\n            screenWidth: node.scrollWidth\n        }\n\n        return domtoimage.toPixelData(node, domtoimageOptions)\n    },\n    _getPixelDataOfBigMap (domtoimageOptions = {}) {\n        const node = this._map.getContainer()\n\n        // fix: https://github.com/grinat/leaflet-simple-map-screenshoter/issues/7\n        // fix memory out error if map scrollHeight and scrollWidth very big\n        const mapPane = this._map.getPane('mapPane')\n\n        const increaser = 2 // <-- when window resize, map resize with translate option, we need what for prevent gray on borders\n        mapPane.style.width = `${node.clientWidth * increaser}px`\n        mapPane.style.height = `${node.clientHeight * increaser}px`\n        mapPane.style.overflow = 'hidden'\n\n        const restoreMapPane = () => {\n            mapPane.style.width = 'initial'\n            mapPane.style.height = 'initial'\n            mapPane.style.overflow = 'initial'\n        }\n\n        this._node = {\n            node,\n            screenHeight: node.scrollHeight,\n            screenWidth: node.scrollWidth\n        }\n\n        return domtoimage.toPixelData(node, domtoimageOptions).then(r => {\n            restoreMapPane()\n            return r\n        }).catch(e => {\n            restoreMapPane()\n            return this.options.onPixelDataFail({\n                plugin: this,\n                node,\n                mapPane,\n                error: e,\n                domtoimageOptions\n            })\n        })\n    },\n    /**\n     * @private\n     */\n    _addScreenBtn () {\n        this._link = L.DomUtil.create(\n            'a',\n            'leaflet-control-simpleMapScreenshoter-btn',\n            this._container\n        )\n        this._addCss()\n        L.DomEvent.addListener(this._link, 'click', this._onScreenBtn, this)\n        L.DomEvent.disableClickPropagation(this._link)\n    },\n    /**\n     * @private\n     */\n    _addCss () {\n        let css = `\n    .leaflet-control-simpleMapScreenshoter{\n       border: 2px solid rgba(0,0,0,0.2);\n       background-clip: padding-box;\n    }\n    .leaflet-control-simpleMapScreenshoter a{\n       background-color: #fff;\n       border-bottom: 1px solid #ccc;\n       width: 30px;\n       height: 30px;\n       line-height: 30px;\n       display: block;\n       text-align: center;\n       text-decoration: none;\n       color: black;\n       overflow: hidden;\n       border-radius: 2px;\n       background-image: url('${this.options.iconUrl}');\n       background-position: 46% 41%;\n       background-repeat: no-repeat;\n       background-size: 63%;\n    }\n    .leaflet-control-simpleMapScreenshoter a:hover{\n       cursor: pointer;\n    }\n    `\n        let head = document.head || document.getElementsByTagName('head')[0]\n        let style = document.createElement('style')\n        style.appendChild(\n            document.createTextNode(\n                css\n            )\n        )\n        head.appendChild(style)\n    },\n    /**\n     * @private\n     */\n    _onScreenBtn () {\n        this._map.fire('simpleMapScreenshoter.click')\n        if (this.options.preventDownload) return\n\n        this.takeScreen().then(blob => {\n            const screenName = typeof this.options.screenName === 'function'\n                ? this.options.screenName.call(this)\n                : this.options.screenName\n\n            fileSaver.saveAs(blob, `${screenName}.png`)\n        }).catch(e => {\n            this._map.fire('simpleMapScreenshoter.error', {e})\n        })\n    }\n})\n\nexport default SimpleMapScreenshoter\n","import { SimpleMapScreenshoter } from \"leaflet-simple-map-screenshoter\";\n\n// Define some maps options\nvar mapOptions = {\n  center: { lat: 40.7, lng: 22.8 },\n  zoom: 6\n};\n\n//Create a map and assign it to the map div\nvar map = L.map(\"leafletMapid\", mapOptions);\n\n// Create some custom panes\nmap.createPane(\"snapshot-pane\");\nmap.createPane(\"dont-include\");\n\n// Add baselayer and geojson to snapshot pane\n\n\n\nconst baselayer = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{\n        maxZoom: 20,\n        subdomains:['mt0','mt1','mt2','mt3'],\n        pane: \"snapshot-pane\"\n}).addTo(map);\n\n// Set up snapshotter\nconst snapshotOptions = {\n  hideElementsWithSelectors: [\n    \".leaflet-control-container\",\n    \".leaflet-dont-include-pane\",\n    \"#snapshot-button\"\n  ],\n  hidden: true\n};\n\n// Add screenshotter to map\nconst screenshotter = new SimpleMapScreenshoter(snapshotOptions);\nscreenshotter.addTo(map);\n\n// What happens when you clikc the \"Snapshot Greek Border\" button:\nconst takeScreenShot = () => {\n  // Get bounds of feature, pad ot a but too\n  \n  // Get the resulting image size that contains the feature\n  const imageSize = {x: 1000, y: 500};\n  const topLeft = {x: 0, y: 0};\n\n  // Set up screenshot function\n  screenshotter\n    .takeScreen(\"image\")\n    .then((image) => {\n      // Create <img> element to render img data\n      var img = new Image();\n\n      // once the image loads, do the following:\n      img.onload = () => {\n        // Create canvas to process image data\n        const canvas = document.createElement(\"canvas\");\n        const ctx = canvas.getContext(\"2d\");\n\n        // Set canvas size to the size of your resultant image\n        canvas.width = imageSize.x;\n        canvas.height = imageSize.y;\n\n        // Draw just the portion of the whole map image that contains\n        // your feature to the canvas\n        // from https://stackoverflow.com/questions/26015497/how-to-resize-then-crop-an-image-with-canvas\n        ctx.drawImage(\n          img,\n          topLeft.x,\n          topLeft.y,\n          imageSize.x,\n          imageSize.y,\n          0,\n          0,\n          imageSize.x,\n          imageSize.y\n        );\n\n        // Create URL for resultant png\n        var imageurl = canvas.toDataURL(\"image/png\");\n        console.log(imageurl);\n\n        const resultantImage = new Image();\n        resultantImage.style = \"border: 1px solid black\";\n        resultantImage.src = imageurl;\n\n        document.body.appendChild(canvas);\n\n        canvas.toBlob(function (blob) {\n          // saveAs function installed as part of leaflet snapshot package\n          console.log(blob);\n\n          let reader = new FileReader();\n        reader.readAsDataURL(blob);\n        reader.onloadend = function () {\n        let base64String = reader.result;\n\n\n          fetch('/upload', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({ \"image\": base64String })\n          })\n          .then(response => response.json())\n          .then(data => console.log(data))\n          .catch((error) => {\n            console.error('Error:', error);\n          });\n        }\n        });\n      };\n\n      // set the image source to what the snapshotter captured\n      // img.onload will fire AFTER this\n      img.src = image;\n    })\n    .catch((e) => {\n      alert(e.toString());\n    });\n};\n\n// Add takescreenshot function to button\nconst button = document.getElementById(\"snapshot-button\");\nbutton.addEventListener(\"click\", takeScreenShot);\n"]}